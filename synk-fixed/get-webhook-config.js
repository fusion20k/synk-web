// Get Stripe Webhook Configuration Values
const readline = require('readline');

const rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout
});

function question(prompt) {
    return new Promise((resolve) => {
        rl.question(prompt, resolve);
    });
}

async function getWebhookConfig() {
    console.log('üîó Stripe Webhook Configuration Generator\n');
    
    console.log('First, get your ngrok URL:');
    console.log('1. Start your Synk app: npm start');
    console.log('2. In another terminal: ngrok http 3001');
    console.log('3. Copy the https URL (e.g., https://abc123.ngrok.io)\n');
    
    const ngrokUrl = await question('Enter your ngrok URL (without /webhook/stripe): ');
    const cleanUrl = ngrokUrl.replace(/\/$/, ''); // Remove trailing slash
    const webhookUrl = cleanUrl + '/webhook/stripe';
    
    console.log('\n' + '='.repeat(60));
    console.log('üìã STRIPE WEBHOOK CONFIGURATION VALUES');
    console.log('='.repeat(60));
    
    console.log('\nüè∑Ô∏è  DESTINATION NAME:');
    console.log('Synk Plan Management');
    
    console.log('\nüåê ENDPOINT URL:');
    console.log(webhookUrl);
    
    console.log('\nüìù DESCRIPTION:');
    console.log('Webhook endpoint for Synk app to receive Stripe payment events and automatically update user subscription plans (trial, pro, ultimate). Handles checkout completion, subscription changes, and payment processing.');
    
    console.log('\nüì° EVENTS TO SELECT (8 events):');
    console.log('‚úÖ checkout.session.completed');
    console.log('‚úÖ checkout.session.async_payment_succeeded');
    console.log('‚úÖ customer.subscription.created');
    console.log('‚úÖ customer.subscription.updated');
    console.log('‚úÖ customer.subscription.deleted');
    console.log('‚úÖ invoice.payment_succeeded');
    console.log('‚úÖ invoice.payment_failed');
    console.log('‚úÖ customer.subscription.trial_will_end');
    
    console.log('\n‚öôÔ∏è  ADDITIONAL SETTINGS:');
    console.log('‚Ä¢ API Version: 2023-10-16');
    console.log('‚Ä¢ Enable webhook signing: ‚úÖ Yes');
    console.log('‚Ä¢ Enable automatic retries: ‚úÖ Yes');
    
    console.log('\n' + '='.repeat(60));
    console.log('üìã COPY-PASTE READY VALUES');
    console.log('='.repeat(60));
    
    console.log('\nDestination Name:');
    console.log('Synk Plan Management');
    
    console.log('\nEndpoint URL:');
    console.log(webhookUrl);
    
    console.log('\nDescription:');
    console.log('Webhook endpoint for Synk app to receive Stripe payment events and automatically update user subscription plans (trial, pro, ultimate). Handles checkout completion, subscription changes, and payment processing.');
    
    console.log('\n‚úÖ Configuration complete! Use these values in your Stripe webhook setup.');
    
    rl.close();
}

// Run the configuration generator
if (require.main === module) {
    getWebhookConfig().catch(console.error);
}

module.exports = getWebhookConfig;
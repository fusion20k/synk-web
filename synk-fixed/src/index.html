<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Synk - Notion & Google Calendar Sync</title>
    <link rel="icon" type="image/x-icon" href="../assets/icon.ico">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a !important;
            color: #fff !important;
            line-height: 1.6;
            height: 100vh;
            overflow: hidden;
        }

        /* Custom Titlebar */
        .titlebar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 32px;
            background: #0f0f0f;
            border-bottom: 1px solid #222;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 16px;
            z-index: 1000;
            -webkit-app-region: drag;
        }

        .titlebar-title {
            font-size: 13px;
            color: #fff;
            font-weight: 500;
        }

        .titlebar-controls {
            display: flex;
            gap: 8px;
            -webkit-app-region: no-drag;
        }

        .titlebar-button {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 12px;
            font-family: 'Segoe UI', sans-serif;
        }

        .titlebar-button:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .titlebar-button.close:hover {
            background-color: #e81123;
        }

        .titlebar-button.minimize::before {
            content: "−";
            font-weight: bold;
        }

        .titlebar-button.maximize::before {
            content: "□";
            font-weight: bold;
        }

        .titlebar-button.close::before {
            content: "×";
            font-weight: bold;
            font-size: 14px;
        }

        /* App Shell Layout */
        .app-container {
            display: flex;
            height: 100vh;
            background: #000;
            border: 2px solid #333; /* Custom border as requested */
            border-radius: 8px;
            padding-top: 32px; /* Space for titlebar */
        }

        /* Left Sidebar */
        .sidebar {
            width: 240px;
            background: #0d0d0d;
            border-right: 1px solid #222;
            display: flex;
            flex-direction: column;
            padding: 20px 0;
        }

        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid #333;
            margin-bottom: 20px;
        }

        .app-logo {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #ff4500, #dc143c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .sidebar-nav {
            flex: 1;
            padding: 0 10px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            margin-bottom: 5px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #ccc;
            text-decoration: none;
        }

        .nav-item:hover {
            background: linear-gradient(135deg, rgba(255, 69, 0, 0.2), rgba(220, 20, 60, 0.2));
            color: #fff;
        }

        .nav-item.active {
            background: linear-gradient(135deg, #ff4500, #dc143c);
            color: #fff;
            border-left: 3px solid #ff4500;
        }

        .nav-icon {
            margin-right: 12px;
            font-size: 1.1rem;
            width: 20px;
            text-align: center;
        }

        /* Main Content Area */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #000;
        }

        /* Top Header Bar */
        .header-bar {
            height: 60px;
            background: #111;
            border-bottom: 1px solid #333;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
        }

        .header-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #fff;
        }

        .status-pills {
            display: flex;
            gap: 10px;
        }

        .status-pill {
            padding: 6px 14px;
            border-radius: 16px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            border: 1px solid transparent;
        }

        .status-pill::before {
            content: '';
            width: 6px;
            height: 6px;
            border-radius: 50%;
            display: inline-block;
        }

        .status-pill.connected {
            background: linear-gradient(135deg, rgba(255, 69, 0, 0.15), rgba(220, 20, 60, 0.15));
            color: #ff4500;
            border: 1px solid rgba(255, 69, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        .status-pill.connected::before {
            background: #ff4500;
            box-shadow: 0 0 6px rgba(255, 69, 0, 0.6);
            animation: pulse 2s infinite;
        }

        .status-pill.connected {
            box-shadow: 0 0 15px rgba(255, 69, 0, 0.4), 0 0 30px rgba(255, 69, 0, 0.2);
        }

        .status-pill.connected::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 69, 0, 0.1), 
                rgba(220, 20, 60, 0.1), 
                rgba(255, 101, 0, 0.1), 
                transparent
            );
            animation: smokeFlow 4s ease-in-out infinite;
        }

        @keyframes smokeFlow {
            0% { 
                left: -100%; 
                opacity: 0;
            }
            20% { 
                opacity: 0.6;
            }
            80% { 
                opacity: 0.6;
            }
            100% { 
                left: 100%; 
                opacity: 0;
            }
        }

        .status-pill.disconnected {
            background: linear-gradient(135deg, rgba(128, 128, 128, 0.15), rgba(96, 96, 96, 0.15));
            color: #888;
            border: 1px solid rgba(128, 128, 128, 0.3);
        }

        .status-pill.disconnected::before {
            background: #888;
            box-shadow: 0 0 6px rgba(128, 128, 128, 0.6);
        }

        /* Content Area */
        .content-area {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #0a0a0a;
        }

        .tab-content {
            display: none;
            height: 100%;
        }

        .tab-content.active {
            display: block;
        }

        /* Cards */
        .content-card {
            background: linear-gradient(135deg, #0f0f0f 0%, #0a0a0a 100%);
            border: 1px solid #222;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.6);
            transition: all 0.3s ease;
        }

        .content-card:hover {
            border-color: #333;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.8);
            transform: translateY(-2px);
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 18px;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .card-title::before {
            content: '';
            width: 4px;
            height: 24px;
            background: linear-gradient(135deg, #ff4500, #dc143c);
            border-radius: 2px;
        }

        /* Sync Tab Specific Styles */
        .sync-container {
            display: flex;
            align-items: flex-start;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .service-section {
            flex: 1;
            max-width: 45%;
            min-width: 400px;
            background: linear-gradient(135deg, #111 0%, #0f0f0f 100%);
            border: 1px solid #333;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .service-section:hover {
            border-color: #444;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }

        .sync-icon {
            font-size: 32px;
            background: linear-gradient(135deg, #ff4500, #dc143c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            align-self: center;
            margin-top: 60px;
        }

        .service-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #333;
        }

        .service-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #fff;
        }

        .connect-btn {
            background: linear-gradient(135deg, #ff4500, #dc143c);
            color: #fff;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(255, 69, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        .connect-btn::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transform: translateX(-100%) translateY(-100%) rotate(45deg);
            transition: transform 0.6s ease;
        }

        .connect-btn:hover::before {
            transform: translateX(100%) translateY(100%) rotate(45deg);
        }

        .connect-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 69, 0, 0.4);
            background: linear-gradient(135deg, #ff6500, #ff1744);
        }

        .connect-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .status {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            font-size: 0.9rem;
        }

        .status.success {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2)) !important;
            color: #a78bfa !important;
            border: 1px solid #667eea;
        }

        .status.error {
            background: #4d1a1a !important;
            color: #f87171 !important;
            border: 1px solid #ef4444;
        }

        .list-container {
            background: #111;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            min-height: 200px;
            max-height: 300px;
            overflow-y: auto;
        }

        .calendar-section {
            margin-bottom: 15px;
        }

        .section-header {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            background: #2a2a2a;
            border: 1px solid #333;
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 8px;
            transition: background 0.2s;
        }

        .section-header:hover {
            background: #333;
        }

        .section-arrow {
            margin-right: 8px;
            font-size: 12px;
            transition: transform 0.2s;
        }

        .section-title {
            font-weight: 500;
            color: #ccc;
            font-size: 14px;
        }

        .section-content {
            margin-left: 20px;
        }

        .calendar-item, .database-item {
            background: #0f0f0f;
            border: 1px solid #222;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            outline: none;
            position: relative;
            width: 100%;
            text-align: left;
            font-family: inherit;
            color: inherit;
        }

        .calendar-item:hover, .database-item:hover,
        .calendar-item:focus, .database-item:focus {
            border-color: #ff4500;
            background: #1a1a1a;
            outline: 2px solid rgba(255, 69, 0, 0.3);
        }

        .calendar-item.selected, .database-item.selected {
            border-color: #ff4500;
            background: linear-gradient(135deg, rgba(255, 69, 0, 0.1), rgba(220, 20, 60, 0.1));
            box-shadow: 0 0 10px rgba(255, 69, 0, 0.3);
        }

        .calendar-item.primary {
            border-left: 4px solid #ff4500;
        }

        .item-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: #fff;
        }

        .item-meta {
            font-size: 0.85rem;
            color: #ccc;
        }

        .demo-badge {
            display: inline-block;
            background: #333;
            color: #667eea;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            margin-left: 8px;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #ccc;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: #fff;
        }

        /* Dashboard Styles */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .connection-card {
            background: #0f0f0f;
            border: 1px solid #222;
            border-radius: 12px;
            padding: 20px;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-dot.connected {
            background: linear-gradient(135deg, #ff4500, #dc143c);
        }

        .status-dot.disconnected {
            background: #f87171;
        }

        /* Settings Styles */
        .setting-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid #333;
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-info h3 {
            color: #fff;
            margin-bottom: 5px;
        }

        .setting-info p {
            color: #ccc;
            font-size: 0.9rem;
        }

        .status-indicator {
            padding: 4px 8px;
            border-radius: 4px;
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid #4CAF50;
            font-size: 12px;
        }

        .action-btn {
            background: linear-gradient(135deg, #ff4500, #dc143c);
            color: #fff;
            border: 1px solid #ff4500;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transform: translateX(-100%) translateY(-100%) rotate(45deg);
            transition: transform 0.6s ease;
        }

        .action-btn:hover::before {
            transform: translateX(100%) translateY(100%) rotate(45deg);
        }

        .action-btn:hover {
            background: linear-gradient(135deg, #ff6500, #ff1744);
            border-color: #ff6500;
            transform: translateY(-1px);
        }

        .spinner {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid #333;
            border-top: 2px solid #ff4500;
            border-right: 2px solid #dc143c;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            box-shadow: 0 0 6px rgba(255, 69, 0, 0.3);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* OAuth Status Styles */
        .oauth-status {
            margin: 15px 0;
            padding: 15px;
            border-radius: 8px;
            background: #0f0f0f;
            border: 1px solid #222;
        }

        .oauth-loading, .oauth-success, .oauth-error {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            gap: 10px;
        }

        .oauth-loading .spinner {
            width: 24px;
            height: 24px;
            border: 2px solid #333;
            border-top: 2px solid #ff4500;
            border-right: 2px solid #dc143c;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            box-shadow: 0 0 8px rgba(255, 69, 0, 0.3);
        }

        .oauth-loading span {
            color: #fff;
            font-weight: 500;
        }

        .oauth-step {
            color: #ccc;
            font-size: 0.9rem;
            margin: 0;
        }

        .success-icon, .error-icon {
            font-size: 32px;
            margin-bottom: 5px;
        }

        .oauth-success span {
            color: #4CAF50;
            font-weight: 500;
        }

        .oauth-error span {
            color: #f44336;
            font-weight: 500;
        }

        .retry-btn {
            background: linear-gradient(135deg, #ff4500, #dc143c);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(255, 69, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        .retry-btn::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transform: translateX(-100%) translateY(-100%) rotate(45deg);
            transition: transform 0.6s ease;
        }

        .retry-btn:hover::before {
            transform: translateX(100%) translateY(100%) rotate(45deg);
        }

        .retry-btn:hover {
            background: linear-gradient(135deg, #ff6500, #ff1744);
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(255, 69, 0, 0.4);
        }

        .retry-btn:disabled {
            background: #333;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Sync Status Panel */
        .sync-status-panel {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 360px;
            background: linear-gradient(135deg, #111 0%, #0f0f0f 100%);
            border: 1px solid #333;
            border-radius: 16px;
            padding: 24px;
            z-index: 1000;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .sync-status-panel:hover {
            border-color: #444;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.8);
        }

        .sync-status-header h3 {
            font-size: 16px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 15px;
        }

        .sync-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px 0;
        }

        .sync-label {
            color: #ccc;
            font-size: 14px;
        }

        .sync-value {
            color: #fff;
            font-size: 14px;
            font-weight: 500;
        }

        .sync-value.selected {
            color: #4CAF50;
        }

        .sync-value.error {
            color: #f44336;
        }

        .sync-value.syncing {
            color: #2196F3;
        }

        /* Professional Sync Status Panel */
        .sync-status-panel {
            position: fixed;
            bottom: 20px;
            left: calc(50% + 120px);
            transform: translateX(-50%);
            background: linear-gradient(135deg, #0f0f0f 0%, #0a0a0a 100%);
            border: 1px solid #222;
            border-radius: 16px;
            padding: 20px 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            z-index: 1000;
            min-width: 400px;
            max-width: 600px;
        }

        .sync-status-content {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .sync-indicator {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .sync-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #666;
            transition: all 0.3s ease;
            flex-shrink: 0;
            position: relative;
        }

        .sync-dot::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border-radius: 50%;
            background: inherit;
            opacity: 0.3;
            transform: scale(0);
            transition: transform 0.3s ease;
        }

        .sync-dot.idle {
            background: #666;
        }

        .sync-dot.ready {
            background: #ff4500;
            box-shadow: 0 0 12px rgba(255, 69, 0, 0.5);
        }

        .sync-dot.ready::before {
            transform: scale(1);
        }

        .sync-dot.syncing {
            background: #ff6500;
            box-shadow: 0 0 12px rgba(255, 101, 0, 0.5);
            animation: pulse 1.5s infinite;
        }

        .sync-dot.syncing::before {
            transform: scale(1);
            animation: ripple 1.5s infinite;
        }

        .sync-dot.error {
            background: #ef4444;
            box-shadow: 0 0 12px rgba(239, 68, 68, 0.5);
        }

        .sync-dot.error::before {
            transform: scale(1);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        @keyframes ripple {
            0% { transform: scale(0); opacity: 0.8; }
            100% { transform: scale(2); opacity: 0; }
        }

        .sync-status-text {
            color: #fff;
            font-size: 14px;
            font-weight: 500;
            flex: 1;
        }

        .sync-details {
            padding-left: 26px;
            border-left: 3px solid #ff4500;
            margin-left: 7px;
            margin-top: 12px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .sync-pair-info {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 12px;
        }

        .sync-source, .sync-target {
            color: #ff4500;
            font-size: 12px;
            font-weight: 600;
            background: linear-gradient(135deg, rgba(255, 69, 0, 0.15), rgba(220, 20, 60, 0.15));
            padding: 6px 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 69, 0, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            max-width: 120px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .sync-arrow {
            color: #ff4500;
            font-size: 18px;
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        .sync-stats {
            display: flex;
            gap: 20px;
            font-size: 11px;
            color: #aaa;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .sync-stats span {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .sync-stats span::before {
            content: '•';
            color: #667eea;
            font-size: 14px;
        }

        .last-sync, .sync-count {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .last-sync::before {
            content: "T";
            font-size: 10px;
        }

        .sync-count::before {
            content: "C";
            font-size: 10px;
        }
    </style>
</head>
<body>
    <!-- Custom Titlebar -->
    <div class="titlebar">
        <div class="titlebar-title">Synk - Notion & Google Calendar Sync</div>
        <div class="titlebar-controls">
            <button class="titlebar-button minimize" id="minimize-btn"></button>
            <button class="titlebar-button maximize" id="maximize-btn"></button>
            <button class="titlebar-button close" id="close-btn"></button>
        </div>
    </div>

    <div class="app-container">
        <!-- Left Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="app-logo">Synk</div>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-item active" data-tab="dashboard">
                    <span class="nav-icon">■</span>
                    <span>Dashboard</span>
                </div>
                <div class="nav-item" data-tab="sync">
                    <span class="nav-icon">↔</span>
                    <span>Sync</span>
                </div>
                <div class="nav-item" data-tab="settings">
                    <span class="nav-icon">⚙</span>
                    <span>Settings</span>
                </div>
                <div class="nav-item" data-tab="logs">
                    <span class="nav-icon">□</span>
                    <span>Logs</span>
                </div>
                <div class="nav-item" data-tab="about">
                    <span class="nav-icon">i</span>
                    <span>About</span>
                </div>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header Bar -->
            <div class="header-bar">
                <div class="header-title" id="header-title">Dashboard</div>
                <div class="status-pills">
                    <div class="status-pill disconnected" id="google-pill">Google</div>
                    <div class="status-pill disconnected" id="notion-pill">Notion</div>
                </div>
            </div>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Dashboard Tab -->
                <div class="tab-content active" id="dashboard-tab">
                    <div class="dashboard-grid">
                        <div class="connection-card">
                            <h3 class="card-title">Google Calendar</h3>
                            <div class="connection-status">
                                <div class="status-dot disconnected" id="google-status-dot"></div>
                                <span id="google-status-text">Not connected</span>
                            </div>
                            <p id="google-user-info" style="color: #ccc; font-size: 0.9rem;">Connect to see your calendars</p>
                        </div>
                        <div class="connection-card">
                            <h3 class="card-title">Notion</h3>
                            <div class="connection-status">
                                <div class="status-dot disconnected" id="notion-status-dot"></div>
                                <span id="notion-status-text">Not connected</span>
                            </div>
                            <p id="notion-user-info" style="color: #ccc; font-size: 0.9rem;">Connect to see your databases</p>
                        </div>
                    </div>
                    <div class="content-card">
                        <h3 class="card-title">Last Sync</h3>
                        <p id="last-sync-info" style="color: #ccc;">No syncs performed yet</p>
                    </div>
                </div>

                <!-- Sync Tab -->
                <div class="tab-content" id="sync-tab">
                    <div class="sync-container">
                        <div class="service-section">
                            <div class="service-header">
                                <h2 class="service-title">Notion</h2>
                                <button class="connect-btn" id="notion-connect">
                                    <span id="notion-text">Connect Notion</span>
                                </button>
                            </div>
                            
                            <!-- OAuth Status Display -->
                            <div id="notion-oauth-status" class="oauth-status" style="display: none;">
                                <div class="oauth-loading" id="notion-loading">
                                    <div class="spinner"></div>
                                    <span>Connecting to Notion...</span>
                                    <p class="oauth-step">Please complete authentication in your browser</p>
                                </div>
                                

                                
                                <div class="oauth-error" id="notion-error" style="display: none;">
                                    <div class="error-icon">❌</div>
                                    <span id="notion-error-message">Connection failed</span>
                                    <button class="retry-btn" id="notion-retry">Retry Connection</button>
                                </div>
                            </div>
                            

                            <div class="list-container" id="notion-content">
                                <div class="empty-state">
                                    <h3>Connect Notion to get started</h3>
                                    <p>Your databases and pages will appear here</p>
                                </div>
                            </div>
                        </div>

                        <div class="sync-icon">↔</div>

                        <div class="service-section">
                            <div class="service-header">
                                <h2 class="service-title">Google Calendar</h2>
                                <button class="connect-btn" id="google-connect">
                                    <span id="google-text">Connect Google</span>
                                </button>
                            </div>
                            
                            <!-- OAuth Status Display -->
                            <div id="google-oauth-status" class="oauth-status" style="display: none;">
                                <div class="oauth-loading" id="google-loading">
                                    <div class="spinner"></div>
                                    <span>Connecting to Google...</span>
                                    <p class="oauth-step">Please complete authentication in your browser</p>
                                </div>
                                

                                
                                <div class="oauth-error" id="google-error" style="display: none;">
                                    <div class="error-icon">❌</div>
                                    <span id="google-error-message">Connection failed</span>
                                    <button class="retry-btn" id="google-retry">Retry Connection</button>
                                </div>
                            </div>
                            

                            <div class="list-container" id="calendars-content">
                                <div class="empty-state">
                                    <h3>Connect Google to get started</h3>
                                    <p>Your calendars will appear here</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Manual Refresh Section -->
                    <div class="refresh-section" style="text-align: center; margin-top: 30px;">
                        <button class="action-btn" id="manual-refresh-btn">
                            <span>Refresh & Sync Now</span>
                        </button>
                        <p style="color: #ccc; font-size: 0.9rem; margin-top: 10px;">
                            Refresh calendar/database lists and force immediate sync
                        </p>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div class="tab-content" id="settings-tab">
                    <div class="content-card">
                        <h3 class="card-title">Application Settings</h3>

                        <div class="setting-item">
                            <div class="setting-info">
                                <h3>Auto Sync</h3>
                                <p>Automatically syncs changes every 1 minute (always enabled)</p>
                            </div>
                            <div class="status-indicator" style="color: #4CAF50; font-weight: bold;">
                                ✓ Always Active
                            </div>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <h3>Clear Data</h3>
                                <p>Remove all stored tokens and reset connections</p>
                            </div>
                            <button class="action-btn" id="clear-data-btn">Clear All Data</button>
                        </div>
                    </div>
                </div>

                <!-- Logs Tab -->
                <div class="tab-content" id="logs-tab">
                    <div class="content-card">
                        <h3 class="card-title">Activity Logs</h3>
                        <div id="logs-container">
                            <p style="color: #ccc;">No activity logs yet</p>
                        </div>
                    </div>
                </div>

                <!-- About Tab -->
                <div class="tab-content" id="about-tab">
                    <div class="content-card about-card">
                        <h2>About Synk</h2>
                        <p style="color: #ccc; margin-bottom: 20px;">Synk syncs Notion and Google Calendar events seamlessly in real-time.</p>
                        
                        <div style="margin-bottom: 30px;">
                            <h3 style="color: #ff4500; margin-bottom: 15px;">Your Plan</h3>
                            <div id="current-plan-display" style="background: linear-gradient(135deg, #111 0%, #0f0f0f 100%); border: 1px solid #333; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                                <div id="plan-status">
                                    <p style="color: #888; margin-bottom: 10px;">Plan Status: <span id="plan-type" style="color: #ff4500;">Detecting...</span></p>
                                    <p style="color: #888; margin-bottom: 15px;" id="plan-description">Checking your subscription status...</p>
                                </div>
                            </div>
                            
                            <h3 style="color: #ff4500; margin-bottom: 15px;">Available Plans</h3>
                            
                            <!-- Pro Plan -->
                            <div style="background: linear-gradient(135deg, #111 0%, #0f0f0f 100%); border: 1px solid #333; border-radius: 12px; padding: 20px; margin-bottom: 15px;">
                                <h4 style="color: #fff; margin-bottom: 10px;">Pro - $12.99/month</h4>
                                <p style="color: #ccc; margin-bottom: 15px;">Perfect for individuals and small teams who need reliable sync.</p>
                                <div style="color: #888; font-size: 0.9rem;">
                                    <p style="margin-bottom: 5px;">• 14-day free trial (no credit card required)</p>
                                    <p style="margin-bottom: 5px;">• Unlimited Notion databases</p>
                                    <p style="margin-bottom: 5px;">• Unlimited Google calendars</p>
                                    <p style="margin-bottom: 5px;">• Real-time bidirectional sync</p>
                                    <p style="margin-bottom: 5px;">• Email support</p>
                                </div>
                            </div>
                            
                            <!-- Ultimate Plan -->
                            <div style="background: linear-gradient(135deg, #111 0%, #0f0f0f 100%); border: 1px solid #333; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                                <h4 style="color: #fff; margin-bottom: 10px;">Ultimate - $24.99/month</h4>
                                <p style="color: #ccc; margin-bottom: 15px;">Advanced features for power users who need more control.</p>
                                <div style="color: #888; font-size: 0.9rem;">
                                    <p style="margin-bottom: 5px;">• Everything in Pro, plus:</p>
                                    <p style="margin-bottom: 5px;">• Custom sync field mapping</p>
                                    <p style="margin-bottom: 5px;">• Advanced filtering & conditions</p>
                                    <p style="margin-bottom: 5px;">• Bulk sync operations</p>
                                    <p style="margin-bottom: 5px;">• Detailed sync analytics</p>
                                    <p style="margin-bottom: 5px;">• Export/import configurations</p>
                                    <p style="margin-bottom: 5px;">• Priority email support</p>
                                </div>
                            </div>
                            
                            <p style="color: #888; font-size: 0.85rem; font-style: italic;">Your free trial will begin automatically when you first connect both services (Pro plan only).</p>
                        </div>
                        
                        <div style="border-top: 1px solid #333; padding-top: 20px;">
                            <p style="color: #ccc; margin-bottom: 10px;">Website: <a id="homepage-link" href="#" style="color: #ff4500; text-decoration: none;">synk-official.com</a></p>
                            <p style="color: #ccc; margin-bottom: 10px;">Support: <a id="support-mail" href="mailto:support@synk-official.com" style="color: #ff4500; text-decoration: none;">support@synk-official.com</a></p>
                            <p style="color: #ccc;">Version: <span id="app-version">1.0.0</span></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Professional Sync Status Panel -->
    <div class="sync-status-panel" id="sync-status-panel">
        <div class="sync-status-content">
            <div class="sync-indicator" id="sync-indicator">
                <div class="sync-dot" id="sync-dot"></div>
                <span class="sync-status-text" id="sync-status-text">Select one Notion database and one Google calendar to sync</span>
            </div>
            <div class="sync-details" id="sync-details" style="display: none;">
                <div class="sync-pair-info">
                    <span class="sync-source" id="sync-source">No selection</span>
                    <span class="sync-arrow">⟷</span>
                    <span class="sync-target" id="sync-target">No selection</span>
                </div>
                <div class="sync-stats" id="sync-stats">
                    <span class="last-sync" id="last-sync">Never synced</span>
                    <span class="sync-count" id="sync-count">0 syncs</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast notification for errors -->
    <div id="error-toast" style="position: fixed; top: 20px; right: 20px; background: #f44336; color: white; padding: 15px; border-radius: 5px; display: none; z-index: 1000; max-width: 300px;">
        <span id="error-message"></span>
        <button onclick="hideErrorToast()" style="background: none; border: none; color: white; float: right; cursor: pointer; font-size: 16px; margin-left: 10px;">&times;</button>
    </div>

    <script>
        // Plan detection and display
        async function loadUserPlan() {
            try {
                console.log('🔍 Loading user plan...');
                const planData = await window.electronAPI.getUserPlan();
                console.log('📋 Plan data received:', planData);
                
                updatePlanDisplay(planData);
            } catch (error) {
                console.error('❌ Error loading user plan:', error);
                // Show default/error state
                updatePlanDisplay({
                    type: 'unknown',
                    name: 'Unknown',
                    description: 'Unable to determine plan status. Please contact support.',
                    features: [],
                    status: 'unknown'
                });
            }
        }
        
        function updatePlanDisplay(planData) {
            const planTypeElement = document.getElementById('plan-type');
            const planDescriptionElement = document.getElementById('plan-description');
            
            if (planTypeElement && planDescriptionElement) {
                let displayName = planData.name || 'Unknown';
                
                // Add trial days remaining ONLY for trial plans
                if (planData.type === 'trial' && planData.trialDaysRemaining !== undefined) {
                    displayName += ` (${planData.trialDaysRemaining} days remaining)`;
                }
                
                // For paid plans, show billing cycle if available
                if ((planData.type === 'pro' || planData.type === 'ultimate') && planData.billingCycle) {
                    displayName += ` (${planData.billingCycle})`;
                }
                
                planTypeElement.textContent = displayName;
                planDescriptionElement.textContent = planData.description || 'No description available';
                
                // Update color based on plan type
                if (planData.type === 'pro') {
                    planTypeElement.style.color = '#4CAF50'; // Green for Pro
                } else if (planData.type === 'ultimate') {
                    planTypeElement.style.color = '#FF6B35'; // Orange for Ultimate
                } else if (planData.type === 'trial') {
                    planTypeElement.style.color = '#2196F3'; // Blue for Trial
                } else if (planData.type === 'expired') {
                    planTypeElement.style.color = '#f44336'; // Red for Expired
                } else {
                    planTypeElement.style.color = '#ff4500'; // Default orange
                }
                
                console.log('✅ Plan display updated:', planData.name);
            }
        }
        
        // Start trial when both services are connected
        async function startTrialIfEligible() {
            try {
                const result = await window.electronAPI.startTrial();
                if (result.success) {
                    console.log('✅ Trial started');
                    updatePlanDisplay(result.plan);
                    showSuccessToast('Your 14-day free trial has started!');
                }
            } catch (error) {
                console.error('❌ Error starting trial:', error);
            }
        }
        
        // Check if user has access to a feature
        async function checkFeatureAccess(feature) {
            try {
                const result = await window.electronAPI.checkFeatureAccess(feature);
                return result.hasAccess;
            } catch (error) {
                console.error('❌ Error checking feature access:', error);
                return false;
            }
        }
        
        // Show feature restriction message
        function showFeatureRestriction(featureName) {
            showErrorToast(`${featureName} is only available in Ultimate plan. Please upgrade to access this feature.`);
        }
        
        // Success toast function
        function showSuccessToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #4CAF50, #45a049);
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 10000;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                font-size: 14px;
                max-width: 300px;
                animation: slideIn 0.3s ease-out;
            `;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }
        
        // Titlebar Controls
        document.addEventListener('DOMContentLoaded', async () => {
            // Load user plan information
            await loadUserPlan();
            
            // Titlebar button handlers
            document.getElementById('minimize-btn').addEventListener('click', () => {
                window.electronAPI.minimize();
            });

            document.getElementById('maximize-btn').addEventListener('click', () => {
                window.electronAPI.maximize();
            });

            document.getElementById('close-btn').addEventListener('click', () => {
                window.electronAPI.close();
            });

            // About page link handlers
            document.getElementById('homepage-link').addEventListener('click', (e) => {
                e.preventDefault();
                window.electronAPI.openExternal('https://synk-official.com');
            });

            // Support email is handled by default mailto: behavior
        });

        // UI State Management
        let isGoogleConnecting = false;
        let isNotionConnecting = false;
        let isGoogleConnected = false;
        let isNotionConnected = false;
        let currentTab = 'dashboard';
        
        // Production mode only - no demo mode detection needed

        // Tab Navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                const tabId = item.dataset.tab;
                switchTab(tabId);
            });
        });

        function switchTab(tabId) {
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');

            // Update content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`${tabId}-tab`).classList.add('active');

            // Update header title
            const titles = {
                dashboard: 'Dashboard',
                sync: 'Sync',
                settings: 'Settings',
                logs: 'Activity Logs',
                about: 'About'
            };
            document.getElementById('header-title').textContent = titles[tabId];
            currentTab = tabId;
        }

        // OAuth Connection Handlers
        document.getElementById('google-connect').addEventListener('click', handleGoogleConnect);
        document.getElementById('notion-connect').addEventListener('click', handleNotionConnect);
        
        // Manual Refresh Handler
        document.getElementById('manual-refresh-btn').addEventListener('click', async () => {
            const btn = document.getElementById('manual-refresh-btn');
            const originalText = btn.innerHTML;
            
            try {
                btn.innerHTML = '<span>Refreshing...</span>';
                btn.disabled = true;
                
                // Refresh Google calendars if connected
                if (isGoogleConnected) {
                    console.log('Refreshing Google calendars...');
                    const calendars = await window.electronAPI.listGoogleCalendars();
                    if (calendars && calendars.length > 0) {
                        renderGoogleCalendars(calendars);
                    }
                }
                
                // Refresh Notion databases if connected
                if (isNotionConnected) {
                    console.log('Refreshing Notion databases...');
                    const databases = await window.electronAPI.listDatabases();
                    if (databases && databases.length > 0) {
                        renderNotionDatabases(databases);
                    }
                }
                
                // Force immediate sync if both are connected and selections made
                if (isGoogleConnected && isNotionConnected && selected.google && selected.notion) {
                    console.log('Forcing immediate sync...');
                    await window.electronAPI.forceSync();
                    updateSyncStatus('syncing', 'Manual sync in progress...');
                }
                
                btn.innerHTML = '<span>✅ Refreshed!</span>';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }, 2000);
                
            } catch (error) {
                console.error('Manual refresh failed:', error);
                btn.innerHTML = '<span>❌ Failed</span>';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }, 2000);
            }
        });

        // Status Update Functions
        function updateGoogleStatus(type, message) {
            const status = document.getElementById('google-status');
            if (status) {
                status.className = `status ${type}`;
                status.textContent = message;
            }
        }

        function updateNotionStatus(type, message) {
            const status = document.getElementById('notion-status');
            if (status) {
                status.className = `status ${type}`;
                status.textContent = message;
            }
        }

        function updateConnectionPill(service, connected) {
            const pill = document.getElementById(`${service}-pill`);
            const dot = document.getElementById(`${service}-status-dot`);
            const text = document.getElementById(`${service}-status-text`);
            
            if (connected) {
                pill.classList.remove('disconnected');
                pill.classList.add('connected');
                dot.classList.remove('disconnected');
                dot.classList.add('connected');
                text.textContent = 'Connected';
            } else {
                pill.classList.remove('connected');
                pill.classList.add('disconnected');
                dot.classList.remove('connected');
                dot.classList.add('disconnected');
                text.textContent = 'Not connected';
            }
        }

        // Display Functions
        function displayCalendars(calendarData) {
            console.log('[Frontend] Received calendars:', calendarData);
            console.log('[Frontend] Calendar data type:', typeof calendarData);
            console.log('[Frontend] Is array:', Array.isArray(calendarData));
            if (calendarData && !Array.isArray(calendarData)) {
                console.log('[Frontend] myCalendars count:', calendarData.myCalendars?.length || 0);
                console.log('[Frontend] otherCalendars count:', calendarData.otherCalendars?.length || 0);
            }
            const container = document.getElementById('calendars-content');
            
            // Handle both old format (array) and new format (object with sections)
            if (Array.isArray(calendarData)) {
                // Old format - just display as before
                if (calendarData.length === 0) {
                    container.innerHTML = '<div class="empty-state"><h3>No calendars found</h3><p>No calendars available in your account</p></div>';
                    return;
                }
                container.innerHTML = calendarData.map(cal => `
                    <button class="sync-item calendar-item ${cal.primary ? 'primary' : ''}" data-id="${cal.id}" onclick="toggleSelect('${cal.id}', 'google')" aria-label="Select ${cal.name} calendar">
                        <div class="item-title">${cal.name}</div>
                        <div class="item-meta">${cal.primary ? 'Primary Calendar • ' : ''}${cal.accessRole} • ${cal.timeZone || 'No timezone'}</div>
                    </button>
                `).join('');
                return;
            }
            
            // New format with sections
            if (!calendarData || (!calendarData.myCalendars && !calendarData.otherCalendars)) {
                container.innerHTML = '<div class="empty-state"><h3>No calendars found</h3><p>No calendars available in your account</p></div>';
                return;
            }

            let html = '';
            
            // My Calendars section (ALWAYS PRESENT)
            const myCalendars = calendarData.myCalendars || [];
            html += `
                <div class="calendar-section">
                    <div class="section-header" onclick="toggleSection('my-calendars')">
                        <span class="section-arrow" id="my-calendars-arrow">▼</span>
                        <span class="section-title">My calendars</span>
                    </div>
                    <div class="section-content" id="my-calendars-content">
                        ${myCalendars.length > 0 ? myCalendars.map(cal => `
                            <button class="sync-item calendar-item ${cal.primary ? 'primary' : ''}" data-id="${cal.id}" onclick="toggleSelect('${cal.id}', 'google')" aria-label="Select ${cal.name} calendar">
                                <div class="item-title">${cal.name}</div>
                                <div class="item-meta">${cal.primary ? 'Primary Calendar • ' : ''}${cal.accessRole} • ${cal.timeZone || 'No timezone'}</div>
                            </button>
                        `).join('') : '<div class="empty-state">No calendars</div>'}
                    </div>
                </div>
            `;
            
            // Other Calendars section (ALWAYS PRESENT)
            const otherCalendars = calendarData.otherCalendars || [];
            html += `
                <div class="calendar-section">
                    <div class="section-header" onclick="toggleSection('other-calendars')">
                        <span class="section-arrow" id="other-calendars-arrow">▼</span>
                        <span class="section-title">Other calendars</span>
                    </div>
                    <div class="section-content" id="other-calendars-content">
                        ${otherCalendars.length > 0 ? otherCalendars.map(cal => `
                            <button class="sync-item calendar-item" data-id="${cal.id}" onclick="toggleSelect('${cal.id}', 'google')" aria-label="Select ${cal.name} calendar">
                                <div class="item-title">${cal.name}</div>
                                <div class="item-meta">${cal.accessRole} • ${cal.timeZone || 'No timezone'}</div>
                            </button>
                        `).join('') : '<div class="empty-state">No other calendars</div>'}
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        function toggleSection(sectionId) {
            const content = document.getElementById(`${sectionId}-content`);
            const arrow = document.getElementById(`${sectionId}-arrow`);
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                arrow.textContent = '▼';
            } else {
                content.style.display = 'none';
                arrow.textContent = '▶';
            }
        }

        function displayDatabases(databases) {
            console.log('[Frontend] Received databases:', databases);
            const container = document.getElementById('notion-content');
            if (!databases || databases.length === 0) {
                container.innerHTML = '<div class="empty-state"><h3>No databases found</h3><p>No databases available in your workspace</p></div>';
                return;
            }

            container.innerHTML = databases.map(db => `
                <button class="sync-item database-item" data-id="${db.id}" onclick="toggleSelect('${db.id}', 'notion')" aria-label="Select ${db.title} database">
                    <div class="item-title">
                        ${db.title}
                    </div>
                    <div class="item-meta">
                        ${db.dateProperties && db.dateProperties.length > 0 ? 
                          `Date fields: ${db.dateProperties.join(', ')}` : 
                          `Properties: ${db.properties ? db.properties.join(', ') : 'None'}`} • 
                        ${db.last_edited_time ? new Date(db.last_edited_time).toLocaleDateString() : 'Unknown date'}
                    </div>
                </button>
            `).join('');
        }

        // Settings Handlers
        // Auto-sync is always enabled - no toggle needed

        document.getElementById('clear-data-btn').addEventListener('click', async () => {
            if (confirm('Are you sure you want to clear all data? This will disconnect all services.')) {
                try {
                    await window.electronAPI.clearAllData();
                    // Reset UI
                    updateConnectionPill('google', false);
                    updateConnectionPill('notion', false);
                    document.getElementById('google-status').textContent = '';
                    document.getElementById('notion-status').textContent = '';
                    document.getElementById('calendars-content').innerHTML = '<div class="empty-state"><h3>Connect Google to get started</h3><p>Your calendars will appear here</p></div>';
                    document.getElementById('notion-content').innerHTML = '<div class="empty-state"><h3>Connect Notion to get started</h3><p>Your databases and pages will appear here</p></div>';
                } catch (error) {
                    console.error('Failed to clear data:', error);
                }
            }
        });

        // Sync Selection State - Fix #4 implementation
        const selected = { notion: null, google: null };
        let autoSyncTimer = null;

        function toggleSelect(id, type) {
            // toggle selection; for this app we want exactly one selected per side:
            selected[type] = selected[type] === id ? null : id;
            renderSelectionUI();
            checkAndTriggerAutoSync();
        }

        function renderSelectionUI() {
            // Update Google calendar selection UI
            document.querySelectorAll('.calendar-item').forEach(item => {
                if (item.dataset.id === selected.google) {
                    item.classList.add('selected');
                } else {
                    item.classList.remove('selected');
                }
            });

            // Update Notion database selection UI
            document.querySelectorAll('.database-item').forEach(item => {
                if (item.dataset.id === selected.notion) {
                    item.classList.add('selected');
                } else {
                    item.classList.remove('selected');
                }
            });

            // Update inline sync status
            updateSyncStatus();
        }

        function checkAndTriggerAutoSync() {
            if (selected.notion && selected.google) {
                // Start trial if both services are connected for the first time
                startTrialIfEligible();
                
                clearTimeout(autoSyncTimer);
                autoSyncTimer = setTimeout(async () => {
                    try {
                        // call IPC: sync now
                        updateSyncStatus('Syncing...');
                        const result = await window.electronAPI.startSync([{ notion: selected.notion, google: selected.google }]);
                        
                        if (result && result.success) {
                            // Wait a moment for sync to complete, then update status
                            setTimeout(async () => {
                                await updateSyncStats();
                                const now = new Date();
                                const timeStr = now.toLocaleTimeString('en-US', { hour12: true, hour: 'numeric', minute: '2-digit' });
                                updateSyncStatus(`Last synced at ${timeStr}`);
                            }, 2000);
                        } else {
                            updateSyncStatus('Sync failed - will retry automatically');
                        }
                    } catch (error) {
                        console.error('Sync error:', error);
                        updateSyncStatus('Sync failed - will retry automatically');
                    }
                }, 1200);
            }
        }

        function updateSyncStatus(status) {
            const syncStatusText = document.getElementById('sync-status-text');
            const syncDot = document.getElementById('sync-dot');
            const syncDetails = document.getElementById('sync-details');
            const syncSource = document.getElementById('sync-source');
            const syncTarget = document.getElementById('sync-target');
            const lastSync = document.getElementById('last-sync');
            const syncCount = document.getElementById('sync-count');
            
            if (!syncStatusText || !syncDot) return;
            
            if (status) {
                // Manual status update (e.g., "Syncing...", "Last synced at 14:30")
                syncStatusText.textContent = status;
                
                if (status.includes('Syncing')) {
                    syncDot.className = 'sync-dot syncing';
                } else if (status.includes('failed') || status.includes('error')) {
                    syncDot.className = 'sync-dot error';
                } else if (status.includes('synced at')) {
                    syncDot.className = 'sync-dot ready';
                } else {
                    syncDot.className = 'sync-dot ready';
                }
            } else {
                // Show current selection status
                const hasNotionSelection = selected.notion !== null;
                const hasGoogleSelection = selected.google !== null;
                
                if (hasNotionSelection && hasGoogleSelection) {
                    syncStatusText.textContent = 'Ready to sync - Auto-sync enabled';
                    syncDot.className = 'sync-dot ready';
                    
                    // Show sync details
                    syncDetails.style.display = 'block';
                    syncSource.textContent = selected.notion.title || 'Notion Database';
                    syncTarget.textContent = selected.google.name || 'Google Calendar';
                    
                    // Update sync stats from backend
                    updateSyncStats();
                    
                } else if (hasNotionSelection || hasGoogleSelection) {
                    syncStatusText.textContent = 'Select one item from each side to sync';
                    syncDot.className = 'sync-dot idle';
                    syncDetails.style.display = 'none';
                } else {
                    syncStatusText.textContent = 'Select one Notion database and one Google calendar to sync';
                    syncDot.className = 'sync-dot idle';
                    syncDetails.style.display = 'none';
                }
            }
        }

        async function updateSyncStats() {
            try {
                const stats = await window.electronAPI.getSyncStats();
                const lastSync = document.getElementById('last-sync');
                const syncCount = document.getElementById('sync-count');
                
                if (lastSync && syncCount) {
                    // Update last sync time
                    if (stats.lastSyncTimes && Object.keys(stats.lastSyncTimes).length > 0) {
                        const lastSyncTime = Object.values(stats.lastSyncTimes)[0];
                        const date = new Date(lastSyncTime);
                        const timeStr = date.toLocaleTimeString('en-US', { hour12: true, hour: 'numeric', minute: '2-digit' });
                        lastSync.textContent = `Last synced at ${timeStr}`;
                    } else {
                        lastSync.textContent = 'Never synced';
                    }
                    
                    // Update sync count
                    syncCount.textContent = `${stats.successfulSyncs || 0} syncs`;
                }
            } catch (error) {
                console.error('Error fetching sync stats:', error);
            }
        }

        // Hide properties panel by default as specified in Fix #4
        const propertiesPanel = document.getElementById('properties-panel');
        if (propertiesPanel) {
            propertiesPanel.style.display = 'none';
        }

        // Error toast functions
        function showErrorToast(message) {
            const toast = document.getElementById('error-toast');
            const messageSpan = document.getElementById('error-message');
            if (toast && messageSpan) {
                messageSpan.textContent = message;
                toast.style.display = 'block';
                // Auto-hide after 5 seconds
                setTimeout(() => hideErrorToast(), 5000);
            }
        }

        function hideErrorToast() {
            const toast = document.getElementById('error-toast');
            if (toast) {
                toast.style.display = 'none';
            }
        }

        function showSuccessToast(message) {
            console.log('[Success]', message);
            // For now, just log to console. You can add a success toast UI later if needed.
        }

        async function fetchNotionDatabases() {
            try {
                console.log('[Frontend] Fetching Notion databases...');
                const result = await window.electronAPI.getDatabases();
                console.log('[Frontend] Raw result from getDatabases:', result);
                
                // Handle the result structure - it might be an array or an object with databases property
                let databases;
                if (Array.isArray(result)) {
                    databases = result;
                } else if (result && result.databases) {
                    databases = result.databases;
                } else {
                    databases = [];
                }
                
                console.log('[Frontend] Processed databases:', databases);
                displayDatabases(databases);
            } catch (error) {
                console.error('[Frontend] Error fetching Notion databases:', error);
                // updateNotionStatus('error', 'Failed to fetch databases'); // Removed status div
            }
        }

        // Production mode only - no sample data needed

        // Event listeners for OAuth success and demo timeout
        if (window.electronAPI) {
            // OAuth success handler - hide connect button
            window.electronAPI.onOAuthSuccess((event, payload) => {
                console.log('OAuth success received:', payload);
                console.log('Payload details:', {
                    provider: payload.provider,
                    account: payload.account,
                    calendars: payload.calendars?.allCalendars?.length || payload.calendars?.length || 0,
                    databases: payload.databases?.length || 0
                });
                
                // Update connection state and hide button
                if (payload.provider === 'notion') {
                    isNotionConnected = true;
                    isNotionConnecting = false;
                    const btn = document.getElementById('notion-connect');
                    if (btn) {
                        btn.style.display = 'none'; // Hide button
                        console.log('✅ Notion connect button hidden');
                    }
                    // updateNotionStatus('success', `Connected to ${payload.account}`); // Removed status div
                    updateConnectionPill('notion', true);
                    if (payload.databases) {
                        displayDatabases(payload.databases);
                    }
    
                } else if (payload.provider === 'google') {
                    isGoogleConnected = true;
                    isGoogleConnecting = false;
                    const btn = document.getElementById('google-connect');
                    if (btn) {
                        btn.style.display = 'none'; // Hide button
                        console.log('✅ Google connect button hidden');
                    }
                    // updateGoogleStatus('success', `Connected to ${payload.account}`); // Removed status div
                    updateConnectionPill('google', true);
                    if (payload.calendars && (payload.calendars.allCalendars?.length > 0 || payload.calendars.length > 0)) {
                        console.log('Displaying calendars:', payload.calendars);
                        displayCalendars(payload.calendars);
                    } else {
                        console.log('Warning: No calendars received in payload');
                        // updateGoogleStatus('warning', 'Connected but no calendars found'); // Removed status div
                    }
    
                }
            });

            // Google calendars handler - receives calendars directly from OAuth server
            window.electronAPI.onGoogleCalendars((event, calendars) => {
                console.log('Google calendars received:', calendars);
                console.log('Calendar details:', {
                    myCalendars: calendars.myCalendars?.length || 0,
                    otherCalendars: calendars.otherCalendars?.length || 0,
                    allCalendars: calendars.allCalendars?.length || 0,
                    items: calendars.items?.length || 0,
                    kind: calendars.kind
                });
                
                // Update Google connection state
                isGoogleConnected = true;
                isGoogleConnecting = false;
                
                // Hide connect button
                const btn = document.getElementById('google-connect');
                if (btn) {
                    btn.style.display = 'none';
                    console.log('✅ Google connect button hidden');
                }
                
                // Update status and display calendars
                updateGoogleStatus('success', 'Connected to Google Calendar');
                
                if (calendars && (calendars.allCalendars?.length > 0 || calendars.items?.length > 0)) {
                    console.log('Displaying calendars:', calendars);
                    displayCalendars(calendars);
                } else {
                    console.log('Warning: No calendar items found');
                    updateGoogleStatus('warning', 'Connected but no calendars found');
                }
                

                
                // Show success toast
                const totalCount = calendars.allCalendars?.length || calendars.items?.length || 0;
                showSuccessToast(`Connected to Google Calendar! Found ${totalCount} calendars.`);
            });

            // FIXED OAuth success handler - stops spinner, shows calendars
            if (window.electronAPI.onOAuthSuccess) {
                window.electronAPI.onOAuthSuccess((event, data) => {
                    console.log('✅ OAuth success received:', data);
                    
                    // Stop infinite loading immediately
                    isGoogleConnected = true;
                    isGoogleConnecting = false;
                    
                    // Hide connect button
                    const btn = document.getElementById('google-connect');
                    if (btn) {
                        btn.style.display = 'none';
                        btn.disabled = false;
                        btn.textContent = 'Connect Google';
                    }
                    
                    // Update status and display calendars
                    // updateGoogleStatus('success', 'Connected to Google Calendar'); // Removed status div
                    updateConnectionPill('google', true);
                    
                    // Handle calendar data (could be in data.calendars or directly in data)
                    const calendars = data.calendars || data;
                    
                    if (calendars && (calendars.allCalendars?.length > 0 || calendars.items?.length > 0)) {
                        displayCalendars(calendars);
                        window.googleCalendars = calendars.allCalendars || calendars.items || calendars;
                        updateSyncSelectionUI();
                    } else {
                        // updateGoogleStatus('warning', 'Connected but no calendars found'); // Removed status div
                    }
                    
    
                    const totalCount = calendars.allCalendars?.length || calendars.items?.length || 0;
                    showSuccessToast(`Connected to Google! Found ${totalCount} calendars.`);
                });
            }

            // FIXED OAuth failure handler - stops spinner, resets button
            if (window.electronAPI.onOAuthFailed) {
                window.electronAPI.onOAuthFailed((event, error) => {
                    console.error('❌ OAuth failed:', error);
                    
                    // Stop infinite loading immediately
                    isGoogleConnecting = false;
                    isGoogleConnected = false;
                    
                    // Show connect button again
                    const btn = document.getElementById('google-connect');
                    if (btn) {
                        btn.style.display = 'block';
                        btn.textContent = 'Connect Google';
                        btn.disabled = false;
                    }
                    
                    updateGoogleStatus('error', 'Connection failed');
                    showErrorToast(`Google connection failed: ${error}`);
                });
            }

            // Google OAuth success handler - receives calendars array directly
            console.log("[Renderer] 🔧 Setting up event listeners...");
            console.log("[Renderer] 🔧 window.electronAPI.on available:", !!window.electronAPI.on);
            if (window.electronAPI.on) {
                console.log("[Renderer] 🔧 Inside electronAPI.on block");
                window.electronAPI.on('google-oauth-success', (event, calendars) => {
                    console.log("[Renderer] Calendars received:", calendars);
                    
                    // Stop loading state
                    isGoogleConnected = true;
                    isGoogleConnecting = false;
                    
                    // Hide connect button
                    const btn = document.getElementById('google-connect');
                    if (btn) {
                        btn.style.display = 'none';
                        btn.disabled = false;
                        btn.textContent = 'Connect Google';
                    }
                    
                    // Update status and display calendars
                    // updateGoogleStatus('success', 'Connected to Google Calendar'); // Removed status div
                    updateConnectionPill('google', true);
                    
                    if (calendars && (calendars.allCalendars?.length > 0 || calendars.length > 0)) {
                        console.log('Displaying calendars:', calendars);
                        displayCalendars(calendars);
        
                        const totalCount = calendars.allCalendars?.length || calendars.length || 0;
                        showSuccessToast(`Connected to Google Calendar! Found ${totalCount} calendars.`);
                    } else {
                        console.log('Warning: No calendars found');
                        // updateGoogleStatus('warning', 'Connected but no calendars found'); // Removed status div
                    }
                });

                // Notion OAuth success handler
                console.log("[Renderer] Registering notion-oauth-success event listener...");
                window.electronAPI.on('notion-oauth-success', async (event, result) => {
                    console.log("[Renderer] NOTION OAUTH SUCCESS EVENT RECEIVED!");
                    console.log("[Renderer] Notion OAuth success:", result);
                    console.log("[Renderer] About to call listDatabases...");
                    
                    // Stop loading state
                    isNotionConnected = true;
                    isNotionConnecting = false;
                    
                    // Hide connect button
                    const btn = document.getElementById('notion-connect');
                    if (btn) {
                        btn.style.display = 'none';
                        btn.disabled = false;
                        btn.textContent = 'Connect Notion';
                    }
                    
                    // Update status
                    updateNotionStatus('success', 'Connected successfully');
                    updateConnectionPill('notion', true);
                    
                    // Hide OAuth status
                    hideNotionOAuthStatus();
                    
                    // Fetch and display databases
                    try {
                        console.log('[Renderer] Fetching Notion databases...');
                        const databases = await window.electronAPI.getDatabases();
                        console.log('[Renderer] Notion databases received:', databases);
                        displayDatabases(databases);
                        
                        // Show workspace name in success message
                        const workspaceName = result.workspace || 'your workspace';
                        showSuccessToast(`Connected to Notion workspace: ${workspaceName}!`);
                    } catch (error) {
                        console.error('[Renderer] Error fetching Notion databases:', error);
                        showErrorToast('Connected to Notion but failed to load databases');
                    }
                });

                // Google OAuth failed handler
                window.electronAPI.on('google-oauth-failed', (event, error) => {
                    console.error("[Renderer] OAuth failed:", error);
                    
                    // Stop loading state
                    isGoogleConnecting = false;
                    isGoogleConnected = false;
                    
                    // Show connect button again
                    const btn = document.getElementById('google-connect');
                    if (btn) {
                        btn.style.display = 'block';
                        btn.disabled = false;
                        btn.textContent = 'Connect Google';
                    }
                    
                    // Update status and show error
                    updateGoogleStatus('error', 'Connection failed');
                    showErrorToast(`Google OAuth failed: ${error || 'Unknown error'}`);
                });

                // Notion OAuth failed handler
                window.electronAPI.on('notion-oauth-failed', (event, error) => {
                    console.error("[Renderer] Notion OAuth failed:", error);
                    
                    // Stop loading state
                    isNotionConnected = false;
                    isNotionConnecting = false;
                    
                    // Show connect button again
                    const btn = document.getElementById('notion-connect');
                    if (btn) {
                        btn.style.display = 'block';
                        btn.textContent = 'Connect Notion';
                        btn.disabled = false;
                    }
                    
                    // Hide OAuth status and show error
                    hideNotionOAuthStatus();
                    updateNotionStatus('error', 'Connection failed');
                    showErrorToast(`Notion OAuth failed: ${error || 'Unknown error'}`);
                });
            }

            // Production mode only - no demo timeout handler needed

            // Connections cleared handler - reset UI
            window.electronAPI.onConnectionsCleared(() => {
                console.log('Connections cleared - resetting UI');
                resetUiToDisconnectedState();
            });

            // Connection error handler (for real mode)
            window.electronAPI.onConnectionError((event, payload) => {
                console.log('Connection error received:', payload);
                showErrorToast(`${payload.provider} connection failed: ${payload.error}`);
                
                // Re-enable the connect button
                if (payload.provider === 'google') {
                    isGoogleConnecting = false;
                    const btn = document.getElementById('google-connect');
                    const text = document.getElementById('google-text');
                    if (btn && text) {
                        btn.disabled = false;
                        text.textContent = 'Connect Google';
                    }
                    updateGoogleStatus('error', `Connection failed: ${payload.error}`);
                } else if (payload.provider === 'notion') {
                    isNotionConnecting = false;
                    const btn = document.getElementById('notion-connect');
                    const text = document.getElementById('notion-text');
                    if (btn && text) {
                        btn.disabled = false;
                        text.textContent = 'Connect Notion';
                    }
                    // updateNotionStatus('error', `Connection failed: ${payload.error}`); // Removed status div
                }
            });
        }

        // Reset UI to disconnected state
        function resetUiToDisconnectedState() {
            // Reset connection states
            isGoogleConnected = false;
            isNotionConnected = false;
            isGoogleConnecting = false;
            isNotionConnecting = false;
            
            // Show connect buttons again
            const notionBtn = document.getElementById('notion-connect');
            const googleBtn = document.getElementById('google-connect');
            
            if (notionBtn) {
                notionBtn.style.display = 'block';
                notionBtn.disabled = false;
                const text = document.getElementById('notion-text');
                if (text) text.textContent = 'Connect Notion';
            }
            
            if (googleBtn) {
                googleBtn.style.display = 'block';
                googleBtn.disabled = false;
                const text = document.getElementById('google-text');
                if (text) text.textContent = 'Connect Google';
            }
            
            // Clear status messages - removed status divs
            // updateNotionStatus('', '');
            // updateGoogleStatus('', '');
            
            // Reset connection pills
            updateConnectionPill('notion', false);
            updateConnectionPill('google', false);
            
            // Clear displayed data
            document.getElementById('notion-content').innerHTML = '<div class="empty-state"><h3>Connect Notion to get started</h3><p>Your databases and pages will appear here</p></div>';
            document.getElementById('calendars-content').innerHTML = '<div class="empty-state"><h3>Connect Google to get started</h3><p>Your calendars will appear here</p></div>';
        }

        // Clear data button handler
        document.getElementById('clear-data-btn').addEventListener('click', async () => {
            try {
                console.log('Clearing all data...');
                await window.electronAPI.clearAllData();
                console.log('✅ Data cleared successfully');
            } catch (error) {
                console.error('❌ Failed to clear data:', error);
                showErrorToast('Reset failed: ' + error.message);
            }
        });

        // Connect handlers with enhanced OAuth UI states
        async function handleGoogleConnect() {
            if (isGoogleConnecting || isGoogleConnected) return;
            
            isGoogleConnecting = true;
            showGoogleOAuthStatus('loading');
            
            try {
                console.log('[Renderer] Starting Google OAuth...');
                
                const result = await window.electronAPI.startGoogleOAuth();
                
                console.log('[Renderer] OAuth result:', {
                    success: result.success,
                    hasError: !!result.error,
                    hasCalendars: !!result.calendars,
                    calendarCount: result.calendars?.allCalendars?.length || result.calendars?.length
                });
                
                if (result.error) {
                    console.error('[Renderer] OAuth error:', result.error);
                    showGoogleOAuthStatus('error', result.error);
                    
                    if (result.error.includes('redirect_uri') || result.error.includes('client_id') || result.error.includes('403')) {
                        showErrorToast('OAuth misconfigured: check redirect URIs and client IDs');
                    }
                    
                    isGoogleConnecting = false;
                } else if (result.success && result.calendars) {
                    // Show success state briefly, then hide OAuth status
                    showGoogleOAuthStatus('success');
                    
                    setTimeout(() => {
                        const totalCount = result.calendars.allCalendars?.length || result.calendars.length || 0;
                        console.log(`[Renderer] SUCCESS: Processing ${totalCount} calendars`);
                        
                        isGoogleConnected = true;
                        isGoogleConnecting = false;
                        
                        // Hide OAuth status and update button
                        hideGoogleOAuthStatus();
                        updateGoogleButton('connected');
                        updateConnectionPill('google', true);
                        
                        displayCalendars(result.calendars);
                        console.log('[Renderer] OAuth flow completed successfully');
                    }, 1500); // Show success for 1.5 seconds
                } else if (result.success) {
                    console.log('[Renderer] OAuth succeeded but no calendars');
                    showGoogleOAuthStatus('success');
                    
                    setTimeout(() => {
                        isGoogleConnected = true;
                        isGoogleConnecting = false;
                        hideGoogleOAuthStatus();
                        updateGoogleButton('connected');
                        updateConnectionPill('google', true);
                    }, 1500);
                } else {
                    // Keep loading state - success will be handled by oauth-success event
                    console.log('[Renderer] OAuth in progress...');
                }
            } catch (error) {
                console.error('[Renderer] OAuth exception:', error);
                showGoogleOAuthStatus('error', error.message);
                showErrorToast(`Google connection failed: ${error.message}`);
                isGoogleConnecting = false;
            }
        }

        async function handleNotionConnect() {
            if (isNotionConnecting || isNotionConnected) return;
            
            isNotionConnecting = true;
            showNotionOAuthStatus('loading');
            
            try {
                console.log('[Renderer] Starting Notion OAuth...');
                
                const result = await window.electronAPI.startNotionOAuth();
                
                console.log('[Renderer] Notion OAuth result:', {
                    success: result.success,
                    hasError: !!result.error,
                    hasData: !!result.data
                });
                
                if (result.error) {
                    console.error('[Renderer] Notion OAuth error:', result.error);
                    showNotionOAuthStatus('error', result.error);
                    
                    if (result.error.includes('redirect_uri') || result.error.includes('client_id') || result.error.includes('403')) {
                        showErrorToast('OAuth misconfigured: check redirect URIs and client IDs');
                    }
                    
                    isNotionConnecting = false;
                } else if (result.success && result.data) {
                    // Show success state briefly, then hide OAuth status
                    showNotionOAuthStatus('success');
                    
                    setTimeout(() => {
                        console.log('[Renderer] SUCCESS: Notion connected successfully');
                        
                        isNotionConnected = true;
                        isNotionConnecting = false;
                        
                        hideNotionOAuthStatus();
                        // updateNotionStatus('success', 'Connected to Notion'); // Removed status div
                        
                        const btn = document.getElementById('notion-connect');
                        const text = document.getElementById('notion-text');
                        if (btn) {
                            btn.disabled = true;
                            btn.classList.add('connected');
                        }
                        if (text) {
                            text.textContent = 'Connected';
                        }
                        
                        // Fetch and display Notion databases
                        console.log('[Frontend] About to fetch Notion databases...');
                        fetchNotionDatabases();
                        
                        showSuccessToast('Notion connected successfully!');
                    }, 2000);
                } else {
                    console.log('[Renderer] Notion OAuth in progress...');
                }
            } catch (error) {
                console.error('[Renderer] Notion OAuth exception:', error);
                showNotionOAuthStatus('error', error.message);
                showErrorToast(`Notion connection failed: ${error.message}`);
                isNotionConnecting = false;
            }
        }

        // OAuth Status UI Helper Functions
        function showGoogleOAuthStatus(state, message = '') {
            const statusContainer = document.getElementById('google-oauth-status');
            const loadingDiv = document.getElementById('google-loading');

            const errorDiv = document.getElementById('google-error');
            const errorMessage = document.getElementById('google-error-message');
            
            // Hide all states first
            loadingDiv.style.display = 'none';
            errorDiv.style.display = 'none';
            
            // Show the container
            statusContainer.style.display = 'block';
            
            // Show the appropriate state
            switch (state) {
                case 'loading':
                    loadingDiv.style.display = 'flex';
                    updateGoogleButton('loading');
                    break;
                case 'success':
                    // Just hide the status container for success
                    statusContainer.style.display = 'none';
                    break;
                case 'error':
                    errorDiv.style.display = 'flex';
                    if (message) {
                        errorMessage.textContent = message;
                    }
                    updateGoogleButton('error');
                    break;
            }
        }
        
        function hideGoogleOAuthStatus() {
            const statusContainer = document.getElementById('google-oauth-status');
            statusContainer.style.display = 'none';
        }
        
        function updateGoogleButton(state) {
            const btn = document.getElementById('google-connect');
            const text = document.getElementById('google-text');
            
            if (!btn || !text) {
                console.warn('[updateGoogleButton] Button or text element not found');
                return;
            }
            
            console.log('[updateGoogleButton] Setting state:', state);
            switch (state) {
                case 'loading':
                    btn.style.display = 'none';
                    console.log('[updateGoogleButton] Hidden button for loading');
                    break;
                case 'connected':
                    btn.style.display = 'none';
                    console.log('[updateGoogleButton] Hidden button for connected');
                    break;
                case 'error':
                    btn.style.display = 'block';
                    btn.disabled = false;
                    text.textContent = 'Connect Google';
                    btn.style.background = '';
                    console.log('[updateGoogleButton] Shown button for error');
                    break;
                default:
                    btn.style.display = 'block';
                    btn.disabled = false;
                    text.textContent = 'Connect Google';
                    btn.style.background = '';
                    console.log('[updateGoogleButton] Shown button for default');
            }
        }
        
        // Add retry button functionality
        document.addEventListener('DOMContentLoaded', () => {
            const retryBtn = document.getElementById('google-retry');
            if (retryBtn) {
                retryBtn.addEventListener('click', () => {
                    console.log('[Renderer] Retry button clicked');
                    hideGoogleOAuthStatus();
                    handleGoogleConnect();
                });
            }
        });

        // Notion OAuth Status UI Helper Functions
        function showNotionOAuthStatus(state, message = '') {
            const statusContainer = document.getElementById('notion-oauth-status');
            const loadingDiv = document.getElementById('notion-loading');

            const errorDiv = document.getElementById('notion-error');
            const errorMessage = document.getElementById('notion-error-message');
            
            // Hide all states first
            loadingDiv.style.display = 'none';
            errorDiv.style.display = 'none';
            
            // Show the container
            statusContainer.style.display = 'block';
            
            // Show the appropriate state
            switch (state) {
                case 'loading':
                    loadingDiv.style.display = 'flex';
                    updateNotionButton('loading');
                    break;
                case 'success':
                    // Just hide the status container for success
                    statusContainer.style.display = 'none';
                    updateNotionButton('connected');
                    break;
                case 'error':
                    errorDiv.style.display = 'flex';
                    errorMessage.textContent = message || 'Connection failed';
                    updateNotionButton('error');
                    break;
            }
        }
        
        function hideNotionOAuthStatus() {
            const statusContainer = document.getElementById('notion-oauth-status');
            statusContainer.style.display = 'none';
        }
        
        function updateNotionButton(state) {
            const btn = document.getElementById('notion-connect');
            const text = document.getElementById('notion-text');
            
            console.log('[updateNotionButton] Setting state:', state);
            switch (state) {
                case 'loading':
                    btn.style.display = 'none';
                    console.log('[updateNotionButton] Hidden button for loading');
                    break;
                case 'connected':
                    btn.style.display = 'none';
                    console.log('[updateNotionButton] Hidden button for connected');
                    break;
                case 'error':
                    btn.style.display = 'block';
                    btn.disabled = false;
                    text.textContent = 'Connect Notion';
                    btn.style.background = '';
                    console.log('[updateNotionButton] Shown button for error');
                    break;
                default:
                    btn.style.display = 'block';
                    btn.disabled = false;
                    text.textContent = 'Connect Notion';
                    btn.style.background = '';
                    console.log('[updateNotionButton] Shown button for default');
            }
        }
        
        // Add Notion retry button functionality
        document.addEventListener('DOMContentLoaded', () => {
            const retryBtn = document.getElementById('notion-retry');
            if (retryBtn) {
                retryBtn.addEventListener('click', () => {
                    console.log('[Renderer] Notion retry button clicked');
                    hideNotionOAuthStatus();
                    handleNotionConnect();
                });
            }
        });

        // Initialize the app
        console.log('Synk app initialized with enhanced OAuth UI');
    </script>
</body>
</html>